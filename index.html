<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asphalt Quote Calculator</title>
<link rel="stylesheet" href="styles.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <div class="header-title">
                    <h1><i class="fas fa-calculator"></i> Asphalt Quote Calculator</h1>
                    <div id="edit-mode-indicator" class="edit-mode-indicator hidden">
                        <i class="fas fa-edit"></i>
                        <span>Editing Quote</span>
                    </div>
        </div>
                <div class="header-actions">
                    <button id="save-quote" class="btn btn-secondary" type="button">
                        <i class="fas fa-save"></i> Save Quote
                    </button>
                    <button id="load-quote" class="btn btn-secondary" type="button">
                        <i class="fas fa-folder-open"></i> Load Quote
                    </button>
                    <a href="search.html" class="btn btn-secondary" type="button">
                        <i class="fas fa-search"></i> Search Quotes
                    </a>
                    <button id="new-quote" class="btn btn-primary" type="button">
                        <i class="fas fa-plus"></i> New Quote
                    </button>
                    <button id="export-pdf" class="btn btn-primary" type="button">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
        </div>
      </div>
        </header>

        <main class="app-main">
            <div class="form-container">
                <form id="quote-form" class="quote-form">
                    <!-- Client Information Section -->
                    <section class="form-section" data-section="client">
                        <div class="section-header">
                            <h2><i class="fas fa-user"></i> Client Information</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content">
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label for="customer_search">Search for Customer</label>
                                    <div class="search-container">
                                        <input id="customer_search" type="text" name="customer_search" placeholder="Search by name, email, or phone...">
                                        <div id="customer-search-results" class="search-results"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="customer-details-display" class="customer-details-container hidden">
                                <!-- Selected customer details will be displayed here -->
                            </div>
                            <div class="form-group mt-4">
                                <button type="button" id="add-new-customer-btn" class="btn btn-secondary">
                                    <i class="fas fa-user-plus"></i> Create New Customer
                                </button>
                                <button type="button" id="clear-customer-btn" class="btn btn-danger hidden">
                                    <i class="fas fa-times"></i> Clear Customer
                                </button>
                            </div>
                            <!-- Hidden fields to store customer data for the quote -->
                            <input type="hidden" id="selected_customer_id" name="selected_customer_id">
                            <input type="hidden" id="project_firstname" name="project-firstname">
                            <input type="hidden" id="project_lastname" name="project-lastname">
                            <input type="hidden" id="project_email" name="project-email">
                            <input type="hidden" id="project_mobile" name="project_mobile">
                            <input type="hidden" id="project_address" name="project_address">
                            <input type="hidden" id="project_apartment" name="project_apartment">
                            <input type="hidden" id="project_city" name="project_city">
                            <input type="hidden" id="project_postcode" name="project_postcode">
                            <input type="hidden" id="project_state" name="project_state">
                            <input type="hidden" id="project_country" name="project_country">
                            <input type="hidden" id="project_company" name="project_company">
                            <input type="hidden" id="project_abn" name="project_abn">
                            <input type="hidden" id="project_phone" name="project_phone">
                            <input type="hidden" id="project_fax" name="project_fax">
                        </div>
                    </section>

                    <!-- Service Details Section -->
                    <section class="form-section" data-section="service">
                        <div class="section-header">
                            <h2><i class="fas fa-tools"></i> Service Details</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content collapsed">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="service_type">Service Type</label>
                                    <select id="service_type" name="service_type">
                                        <option value="">Select a service</option>
          <option value="Overlay">Overlay</option>
          <option value="Sealcoating">Sealcoating</option>
          <option value="Pothole Repair">Pothole Repair</option>
          <option value="Crack Repair">Crack Repair</option>
                                        <option value="Linemarking">Linemarking</option>
        </select>
      </div>
                                <div class="form-group">
                                    <label for="traffic_control">Traffic Control Required?</label>
                                    <select id="traffic_control" name="traffic_control">
          <option value="No">No</option>
          <option value="Yes">Yes</option>
        </select>
      </div>
                            </div>
                            
                            <!-- Traffic Control Details -->
                            <div id="traffic-control-details" class="conditional-section hidden">
                                <h3>Traffic Control Details</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="traffic_control_type">Traffic Control Type</label>
                                        <select id="traffic_control_type" name="traffic-control-type">
                                            <option value="">Select type</option>
                                            <option value="Stop/Slow">Stop/Slow</option>
                                            <option value="Lane Closure">Lane Closure</option>
                                            <option value="Road Closure">Road Closure</option>
                                            <option value="Pedestrian Management">Pedestrian Management</option>
                                            <option value="School Zone">School Zone</option>
                                            <option value="Event Traffic">Event Traffic</option>
                                            <option value="Emergency Response">Emergency Response</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
          <label for="traffic_control_hours_required">Hours Required</label>
                                        <input id="traffic_control_hours_required" type="number" name="traffic-control-hours-required" min="0" step="0.5" placeholder="e.g., 8">
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_workers_required">Workers Required</label>
                                        <input id="traffic_control_workers_required" type="number" name="traffic-control-workers-required" min="0" placeholder="e.g., 2">
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_hourly_rate">Traffic Controller Rate ($/hr)</label>
                                        <input id="traffic_control_hourly_rate" type="number" name="traffic-control-hourly-rate" min="0" step="0.01" value="45" placeholder="45">
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_equipment">Equipment Required</label>
                                        <div class="multi-select-container">
                                            <div class="multi-select-display" id="traffic_control_equipment_display">
                                                <span class="placeholder">Select equipment</span>
                                            </div>
                                            <div class="multi-select-dropdown" id="traffic_control_equipment_dropdown">
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Stop/Slow Signs" data-field="traffic_control_equipment">
                                                    <span>Stop/Slow Signs</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Barriers & Cones" data-field="traffic_control_equipment">
                                                    <span>Barriers & Cones</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Arrow Boards" data-field="traffic_control_equipment">
                                                    <span>Arrow Boards</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Portable Traffic Lights" data-field="traffic_control_equipment">
                                                    <span>Portable Traffic Lights</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Safety Vests & PPE" data-field="traffic_control_equipment">
                                                    <span>Safety Vests & PPE</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Communication Radios" data-field="traffic_control_equipment">
                                                    <span>Communication Radios</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="All Equipment" data-field="traffic_control_equipment">
                                                    <span>All Equipment</span>
                                                </label>
                                            </div>
                                        </div>
                                        <input type="hidden" id="traffic_control_equipment" name="traffic-control-equipment">
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_permits">Permits Required</label>
                                        <div class="multi-select-container">
                                            <div class="multi-select-display" id="traffic_control_permits_display">
                                                <span class="placeholder">Select permits</span>
                                            </div>
                                            <div class="multi-select-dropdown" id="traffic_control_permits_dropdown">
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="No" data-field="traffic_control_permits">
                                                    <span>No Permits</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Local Council" data-field="traffic_control_permits">
                                                    <span>Local Council</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="State Government" data-field="traffic_control_permits">
                                                    <span>State Government</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Police Approval" data-field="traffic_control_permits">
                                                    <span>Police Approval</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Multiple Permits" data-field="traffic_control_permits">
                                                    <span>Multiple Permits</span>
                                                </label>
                                            </div>
                                        </div>
                                        <input type="hidden" id="traffic_control_permits" name="traffic-control-permits">
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_notification">Notification Period</label>
                                        <select id="traffic_control_notification" name="traffic-control-notification">
                                            <option value="Immediate">Immediate</option>
                                            <option value="24 Hours">24 Hours</option>
                                            <option value="48 Hours">48 Hours</option>
                                            <option value="1 Week">1 Week</option>
                                            <option value="2 Weeks">2 Weeks</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_complexity">Complexity Level</label>
                                        <select id="traffic_control_complexity" name="traffic-control-complexity">
                                            <option value="Low">Low (Simple road work)</option>
                                            <option value="Medium">Medium (Busy intersection)</option>
                                            <option value="High">High (Major road closure)</option>
                                            <option value="Critical">Critical (Emergency response)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="traffic_control_weather">Weather Considerations</label>
                                        <div class="multi-select-container">
                                            <div class="multi-select-display" id="traffic_control_weather_display">
                                                <span class="placeholder">Select weather conditions</span>
                                            </div>
                                            <div class="multi-select-dropdown" id="traffic_control_weather_dropdown">
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="None" data-field="traffic_control_weather">
                                                    <span>None</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Rain" data-field="traffic_control_weather">
                                                    <span>Rain</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Wind" data-field="traffic_control_weather">
                                                    <span>Wind</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Heat" data-field="traffic_control_weather">
                                                    <span>Heat</span>
                                                </label>
                                                <label class="multi-select-option">
                                                    <input type="checkbox" value="Multiple" data-field="traffic_control_weather">
                                                    <span>Multiple Conditions</span>
                                                </label>
                                            </div>
                                        </div>
                                        <input type="hidden" id="traffic_control_weather" name="traffic-control-weather">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="traffic_control_notes">Traffic Control Notes</label>
                                        <textarea id="traffic_control_notes" name="traffic-control-notes" rows="3" placeholder="Additional notes about traffic control requirements, special considerations, or specific instructions..."></textarea>
        </div>
        </div>
      </div>

                    </section>

                    <!-- Excavation Section (Refactored) -->
                    <section class="form-section" data-section="excavation">
                        <div class="section-header">
                            <h2><i class="fas fa-dump-truck"></i> Excavation</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content collapsed">
                            <!-- A. Equipment Setup (General) -->
                            <div class="subsection">
                                <h3>Equipment Setup</h3>
                                <p class="text-sm text-secondary mb-4">Add all excavation machines to be used for this project. Assign machines globally or per excavation item.</p>
                                <div id="excavation-equipment-list"></div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="equipment_type">Machine Type</label>
                                        <input id="equipment_type" type="text" placeholder="e.g., 1.5t Excavator, Bobcat">
                                    </div>
                                    <div class="form-group">
                                        <label for="equipment_hire_type">Hire Type</label>
                                        <select id="equipment_hire_type">
                                            <option value="wet">Wet Hire (with operator)</option>
                                            <option value="dry">Dry Hire (machine only)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="equipment_hourly_rate">Hourly Rate ($/hr)</label>
                                        <input id="equipment_hourly_rate" type="number" min="0" step="0.01" placeholder="e.g., 120">
                                    </div>
                                    <div class="form-group">
                                        <label for="equipment_assign_mode">Assign To</label>
                                        <select id="equipment_assign_mode">
                                            <option value="all">All Excavation Items</option>
                                            <option value="per">Assign Per Item</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <button type="button" id="add-excavation-equipment" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Add Equipment
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- B. Excavation Items (Per Task) -->
                            <div class="subsection">
                                <h3>Excavation Items</h3>
                                <p class="text-sm text-secondary mb-4">Add each excavation task or stage. Assign equipment, enter area, material, depth, and disposal info. Use the 3rd party toggle if handled externally.</p>
                                <div id="excavation-items-cards"></div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="excavation_item_description">Description</label>
                                        <input id="excavation_item_description" type="text" placeholder="e.g., Stage 1 - Asphalt removal">
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_area">Area (mm²)</label>
                                        <div style="display:flex;gap:0.5em;align-items:center;">
                                            <input id="excavation_item_area" type="number" min="0" step="1">
                                            <button type="button" id="excavation-area-calc-btn" class="btn btn-secondary btn-sm" title="Calculate Area"><i class="fas fa-calculator"></i> Calculate Area</button>
                                        </div>
                                        <div id="excavation-area-breakdown" class="area-breakdown-list"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_volume">Volume (mm³)</label>
                                        <input id="excavation_item_volume" type="number" min="0" step="1" placeholder="Enter if known (optional)">
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_material">Material</label>
                                        <select id="excavation_item_material">
                                            <option value="">Select material</option>
                                            <option value="Grass/Turf">Grass/Turf</option>
                                            <option value="Topsoil">Topsoil</option>
                                            <option value="Clay">Clay</option>
                                            <option value="Sand">Sand</option>
                                            <option value="Gravel">Gravel</option>
                                            <option value="CBR-45">CBR-45 Road Base</option>
                                            <option value="CBR-80">CBR-80 Road Base</option>
                                            <option value="Concrete">Concrete</option>
                                            <option value="Asphalt">Asphalt</option>
                                            <option value="Rock">Rock</option>
                                            <option value="Mixed">Mixed Materials</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_depth">Depth (mm)</label>
                                        <input id="excavation_item_depth" type="number" min="0" step="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_equipment">Assigned Equipment</label>
                                        <select id="excavation_item_equipment">
                                            <option value="">Select equipment</option>
                                            <!-- Dynamically populated -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_machine_hours">Machine Hours</label>
                                        <input id="excavation_item_machine_hours" type="number" min="0" step="0.1" placeholder="Manual or auto-calculated">
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_disposal">Disposal Type</label>
                                        <select id="excavation_item_disposal">
                                            <option value="Reuse">Reuse On Site</option>
                                            <option value="General">General Waste</option>
                                            <option value="Clean Fill">Clean Fill</option>
                                            <option value="Concrete">Concrete Waste</option>
                                            <option value="Asphalt">Asphalt Waste</option>
                                            <option value="Contaminated">Contaminated</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="excavation_item_tip_fee">Tip Fee ($/tonne)</label>
                                        <input id="excavation_item_tip_fee" type="number" min="0" step="0.01" value="150">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" id="add-excavation-item-card" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Add Excavation Item
                                        </button>
                                    </div>
                                </div>
                                <!-- Mini summaries per item -->
                                <div id="excavation-items-summary"></div>
                                <!-- Third-party excavation items list -->
                                <div id="third-party-items-list"></div>
                            </div>

                            <!-- Advanced Settings Toggle -->
                            <div class="subsection">
                                <button type="button" id="toggle-advanced-excavation" class="btn btn-secondary">
                                    <i class="fas fa-cogs"></i> Show Advanced Settings
                                </button>
                                <div id="advanced-excavation-settings" class="hidden mt-4">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="excavator_bucket_size">Excavator Bucket Size (m³)</label>
                                            <input id="excavator_bucket_size" type="number" min="0" step="0.1" value="0.5">
                                        </div>
                                        <div class="form-group">
                                            <label for="truck_capacity">Truck Capacity (m³)</label>
                                            <input id="truck_capacity" type="number" min="0" step="0.1" value="12">
                                        </div>
                                        <div class="form-group">
                                            <label for="trucks_available">Number of Trucks Available</label>
                                            <input id="trucks_available" type="number" min="1" value="2">
                                        </div>
                                        <div class="form-group">
                                            <label for="operation_efficiency">Operation Efficiency (%)</label>
                                            <input id="operation_efficiency" type="number" min="0" max="100" step="1" value="75">
                                            <small class="text-secondary">Accounts for breaks, positioning, and other delays</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="round_trip_time">Round Trip Time (minutes)</label>
                                            <input id="round_trip_time" type="number" min="0" step="1" value="45">
                                            <small class="text-secondary">Time for truck to travel to disposal site and return</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="excavator_cycle_time">Excavator Cycle Time (minutes)</label>
                                            <input id="excavator_cycle_time" type="number" min="0" step="0.1" value="2">
                                            <small class="text-secondary">Average time per excavator cycle (loading, swinging, dumping)</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Excavation Summary (by item, equipment, disposal, 3rd party) -->
                            <div id="excavation-summary" class="mt-4 p-4 bg-gray-50 rounded-md hidden">
                                <h5 class="font-semibold mb-2">Excavation Summary</h5>
                                <div id="excavation-summary-content"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Project Details Section -->
                    <section class="form-section" data-section="project">
                        <div class="section-header">
                            <h2><i class="fas fa-clipboard-list"></i> Project Details</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="quote_number">Quote Number</label>
                                    <input id="quote_number" type="text" name="quote-number">
                                </div>
                                <div class="form-group">
                                    <label for="valid_for">Valid For (Days)</label>
                                    <input id="valid_for" type="number" name="valid-for" value="30" min="1" max="365">
                                </div>
                                <div class="form-group">
                                    <label for="profit_margin">Margin (%)</label>
                                    <input id="profit_margin" type="number" name="profit-margin" value="40" min="0" max="100" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="discount">Discount (%)</label>
                                    <input id="discount" type="number" name="discount" value="0" min="0" max="100" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="tax_rate">Tax Rate (%)</label>
                                    <input id="tax_rate" type="number" name="tax_rate" value="10" min="0" max="50" step="0.1">
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Materials Section -->
                    <section class="form-section" data-section="materials">
                        <div class="section-header">
                            <h2><i class="fas fa-layer-group"></i> Materials</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content collapsed">
                            <!-- Material Import Subsection -->
                            <div class="subsection">
                                <h3>Material Import</h3>
                                <p class="text-sm text-secondary mb-4">Add materials to be imported to the site, including asphalt for the project</p>
                                
                                <div id="import-materials-container">
                                    <!-- Import material items will be added here dynamically -->
                                </div>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="new_import_material">Material to Import</label>
                                        <select id="new_import_material" name="new-import-material">
                                            <option value="">Select material</option>
                                            <option value="Asphalt">Asphalt (2.4 t/m³)</option>
                                            <option value="Topsoil">Topsoil (1.2 t/m³)</option>
                                            <option value="Clay">Clay (1.4 t/m³)</option>
                                            <option value="Sand">Sand (1.6 t/m³)</option>
                                            <option value="Gravel">Gravel (1.8 t/m³)</option>
                                            <option value="CBR-45">CBR-45 Road Base (2.0 t/m³)</option>
                                            <option value="CBR-80">CBR-80 Road Base (2.1 t/m³)</option>
                                            <option value="Concrete">Concrete (2.4 t/m³)</option>
                                            <option value="Rock">Rock (2.7 t/m³)</option>
                                            <option value="None">No Import Required</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_area">Import Area (sq m)</label>
                                        <div style="display:flex;gap:0.5em;align-items:center;">
                                            <input id="new_import_area" type="number" name="new-import-area" min="0" step="0.01" placeholder="e.g., 100">
                                            <button type="button" id="import-area-calc-btn" class="btn btn-secondary btn-sm" title="Calculate Area"><i class="fas fa-calculator"></i> Calculate Area</button>
                                        </div>
                                        <div id="import-area-breakdown" class="area-breakdown-list"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_depth">Import Depth (mm)</label>
                                        <input id="new_import_depth" type="number" name="new-import-depth" min="0" step="1" placeholder="e.g., 30">
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_volume">Volume to Import (m³)</label>
                                        <input id="new_import_volume" type="number" name="new-import-volume" min="0" step="0.01" placeholder="Auto-calculated or manual input">
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_density">Material Density (t/m³)</label>
                                        <input id="new_import_density" type="number" name="new-import-density" min="0" step="0.1" placeholder="Auto-filled based on material">
                                        <small class="text-secondary">Can be edited if different from standard density</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_compaction">Compaction (%)</label>
                                        <input id="new_import_compaction" type="number" name="new-import-compaction" min="0" step="1" value="0" placeholder="Auto-filled based on material">
                                        <small class="text-secondary">0 = no compaction, 25 = 25% compaction (1.25×)</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_cost_per_tonne">Import Material Cost ($/tonne)</label>
                                        <input id="new_import_cost_per_tonne" type="number" name="new-import-cost-per-tonne" min="0" step="0.01" value="190" placeholder="190">
                                    </div>
                                    <div class="form-group" id="import_tip_fee_group" style="display:none;">
                                        <label for="new_import_tip_fee">Tip Fee ($/tonne)</label>
                                        <input id="new_import_tip_fee" type="number" name="new-import-tip-fee" min="0" step="0.01" value="150">
                                    </div>
                                    <div class="form-group">
                                        <label for="new_import_machine_hours">Machine Hours Required</label>
                                        <input id="new_import_machine_hours" type="number" name="new-import-machine-hours" min="0" step="0.5" placeholder="e.g., 4 (0 if 3rd party delivery)">
                                        <small class="text-secondary">Hours needed for rollers/compactors to install material (0 if delivered and dumped by 3rd party)</small>
                                    </div>
                                    <div class="form-group">
                                        <button type="button" id="add-import-material" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Add Import Material
                                        </button>
                                    </div>
                                </div>

                                <!-- Import Summary -->
                                <div id="import-summary" class="mt-4 p-4 bg-gray-50 rounded-md hidden">
                                    <h5 class="font-semibold mb-2">Import Summary</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span class="font-medium">Total Volume:</span>
                                            <span id="total_import_volume">0 m³</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">Total Weight:</span>
                                            <span id="total_import_weight">0 tonnes</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">Total Cost:</span>
                                            <span id="total_import_cost">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Emulsion Subsection -->
                            <div class="subsection">
                                <h3>Emulsion Tack Coat</h3>
                                <p class="text-sm text-secondary mb-4">Standard tack coat coverage is 0.15–0.30 L/m² residual binder, or 0.5–0.8 L/m² of diluted emulsion</p>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="emulsion_type">Emulsion Type</label>
                                        <select id="emulsion_type" name="emulsion_type">
                                            <option value="">Select emulsion type</option>
                                            <option value="C170K">C170K - Cationic Rapid Set (0.65 L/m²)</option>
                                            <option value="C320K">C320K - Cationic Medium Set (0.65 L/m²)</option>
                                            <option value="C600K">C600K - Cationic Slow Set (0.65 L/m²)</option>
                                            <option value="A170K">A170K - Anionic Rapid Set (0.65 L/m²)</option>
                                            <option value="A320K">A320K - Anionic Medium Set (0.65 L/m²)</option>
                                            <option value="A600K">A600K - Anionic Slow Set (0.65 L/m²)</option>
                                            <option value="Custom">Custom Coverage Rate</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="emulsion_coverage">Coverage Rate (L/m²)</label>
                                        <input id="emulsion_coverage" name="emulsion_coverage" type="number" min="0" step="0.01" value="0.65" placeholder="0.65">
                                        <small class="text-secondary">Standard range: 0.5-0.8 L/m² diluted emulsion</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="emulsion_cost_per_litre">Cost per Litre ($)</label>
                                        <input id="emulsion_cost_per_litre" name="emulsion_cost_per_litre" type="number" min="0" step="0.01" value="1.50" placeholder="1.50">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Labor Section -->
                    <section class="form-section" data-section="labor">
                        <div class="section-header">
                            <h2><i class="fas fa-users"></i> Labor</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
        </div>
      </div>
                        <div class="section-content collapsed">
                            <!-- Standard Labor Roles Section -->
                            <div class="subsection">
                                <h3>Standard Labor Roles</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="labor_role_type">Worker Type</label>
                                        <select id="labor_role_type" name="labor_role_type">
                                            <option value="Labourer">Labourer</option>
                                            <option value="Supervisor">Supervisor</option>
                                            <option value="Operator">Operator</option>
                                            <option value="Engineer">Engineer</option>
                                            <option value="Foreman">Foreman</option>
                                            <option value="Apprentice">Apprentice</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="labor_role_workers">Number of Workers</label>
                                        <input id="labor_role_workers" name="labor_role_workers" type="number" min="1" value="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="labor_role_hours">Total Hours</label>
                                        <input id="labor_role_hours" name="labor_role_hours" type="number" min="0" step="0.1" value="8">
                                    </div>
                                    <div class="form-group">
                                        <label for="labor_role_days">Number of Days</label>
                                        <input id="labor_role_days" name="labor_role_days" type="number" min="1" value="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="labor_role_rate">Hourly Rate ($)</label>
                                        <input id="labor_role_rate" name="labor_role_rate" type="number" min="0" step="0.01" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label>Penalty Rate</label>
                                        <div class="checkbox-group">
                                            <label for="labor_role_public_holiday">
                                                <input id="labor_role_public_holiday" name="labor_role_public_holiday" type="checkbox">
                                                Public Holiday (2.5×)
                                            </label>
                                            <label for="labor_role_sunday">
                                                <input id="labor_role_sunday" name="labor_role_sunday" type="checkbox">
                                                Sunday (2×)
                                            </label>
                                            <label for="labor_role_saturday">
                                                <input id="labor_role_saturday" name="labor_role_saturday" type="checkbox">
                                                Saturday (1.5×)
                                            </label>
                                            <label for="labor_role_after_hours">
                                                <input id="labor_role_after_hours" name="labor_role_after_hours" type="checkbox">
                                                Overnight/After Hours (1.5×)
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <button type="button" id="add-labor-role-btn" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Add Labor Role
                                        </button>
                                    </div>
                                </div>
                                <div id="labor-roles-list" class="labor-list" style="margin-top:1rem;"></div>
                                <div id="labor-roles-total" class="text-success font-medium" style="margin-top:0.5rem;"></div>
                                <div class="form-grid" style="margin-top:1.5rem;">
                                    <div class="form-group">
                                        <label for="superannuation">Superannuation Rate (%)</label>
                                        <input id="superannuation" type="number" name="superannuation" value="11" min="0" max="100" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="workers_compensation">Workers Compensation (%)</label>
                                        <input id="workers_compensation" type="number" name="workers_compensation" value="2" min="0" max="100" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="other_labor_costs">Other Costs (%)</label>
                                        <input id="other_labor_costs" type="number" name="other-labor-costs" value="2" min="0" max="100" step="0.1">
                                    </div>
                                </div>

                            </div>

                            <!-- Other Labor Subsection -->
                            <div class="subsection">
                                <h3>Additional Labor</h3>
                                <div class="other-labor-form">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="other_labor_type">Type</label>
                                            <input id="other_labor_type" name="other_labor_type" type="text" placeholder="e.g., Subcontractor, Specialist">
          </div>
                                <div class="form-group">
                                    <label for="other_labor_pricing_method">Pricing Method</label>
                                    <select id="other_labor_pricing_method" name="other_labor_pricing_method">
                                        <option value="hourly" selected>Hourly</option>
                                        <option value="fixed">Fixed</option>
                                    </select>
                                </div>
                                <div class="form-group" id="other_labor_hours_group">
                                    <label for="other_labor_est_hours">Hours</label>
                                    <input id="other_labor_est_hours" name="other_labor_est_hours" type="number" value="0" min="0" step="0.5">
          </div>
                                <div class="form-group" id="other_labor_rate_group">
                                    <label for="other_labor_cost_per_hour">Cost per Hour ($)</label>
                                    <input id="other_labor_cost_per_hour" name="other_labor_cost_per_hour" type="number" value="0" min="0" step="0.01">
          </div>
                                <div class="form-group" id="other_labor_fixed_group" style="display:none;">
                                    <label for="other_labor_fixed_amount">Total Amount ($)</label>
                                    <input id="other_labor_fixed_amount" name="other_labor_fixed_amount" type="number" value="0" min="0" step="0.01">
                                </div>
                                <div class="form-group checkbox-group">
                                    <label for="add_gst">
                                        <input id="add_gst" type="checkbox" name="add_gst">
                                        Add GST
                                    </label>
          </div>
                                        <div class="form-group">
                                            <button type="button" id="add-labor-btn" class="btn btn-success">
                                                <i class="fas fa-plus"></i> Add Labor
                                            </button>
      </div>
      </div>
    </div>

                                <div id="labor-list" class="labor-list">
                                    <!-- Labor items will be added here dynamically -->
                                </div>
        </div>
      </div>
                    </section>

                    <!-- Consumables Section -->
                    <section class="form-section" data-section="consumables">
                        <div class="section-header">
                            <h2><i class="fas fa-gas-pump"></i> Consumables</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
        </div>
      </div>
                        <div class="section-content collapsed">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="paint_required">Spray Paint (Qty)</label>
                                    <input id="paint_required" type="number" name="paint_required" value="1" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="paint_cost">Paint Cost ($)</label>
                                    <input id="paint_cost" type="number" name="paint_cost" value="3.99" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="petrol_required">Petrol (Litres)</label>
                                    <input id="petrol_required" type="number" name="petrol_required" value="0" min="0" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="petrol_cost">Petrol Cost ($/L)</label>
                                    <input id="petrol_cost" type="number" name="petrol_cost" value="2" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="diesel_required">Diesel (Litres)</label>
                                    <input id="diesel_required" type="number" name="diesel_required" value="0" min="0" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="diesel_cost">Diesel Cost ($/L)</label>
                                    <input id="diesel_cost" type="number" name="diesel_cost" value="2" min="0" step="0.01">
        </div>
                                <div class="form-group">
                                    <label for="gas_required">Gas (Litres)</label>
                                    <input id="gas_required" type="number" name="gas_required" value="0" min="0" step="0.1">
      </div>
                                <div class="form-group">
                                    <label for="gas_cost">Gas Cost ($/L)</label>
                                    <input id="gas_cost" type="number" name="gas_cost" value="1.5" min="0" step="0.01">
        </div>
      </div>
                        </div>
                    </section>

                    <!-- Equipment Section -->
                    <section class="form-section" data-section="equipment">
                        <div class="section-header">
                            <h2><i class="fas fa-truck"></i> Equipment Required</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
    </div>
                        <div class="section-content collapsed">
                            <div class="equipment-grid">
                                <div class="form-group">
        <label for="compactor_plate">Compactor Plate</label>
                                    <input id="compactor_plate" type="number" name="compactor_plate" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="rammer_compactor">Rammer Compactor</label>
                                    <input id="rammer_compactor" type="number" name="rammer_compactor" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="leaf_blower">Leaf Blower</label>
                                    <input id="leaf_blower" type="number" name="leaf_blower" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="concrete_cutter">Concrete Cutter</label>
                                    <input id="concrete_cutter" type="number" name="concrete_cutter" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="_1t_roller">1t Roller</label>
                                    <input id="_1t_roller" type="number" name="1t_roller" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="_2t_roller">2t Roller</label>
                                    <input id="_2t_roller" type="number" name="2t_roller" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="skidsteer">Skidsteer</label>
                                    <input id="skidsteer" type="number" name="skidsteer" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="mr_truck">MR Truck</label>
                                    <input id="mr_truck" type="number" name="mr_truck" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="hr_truck">HR Truck</label>
                                    <input id="hr_truck" type="number" name="hr_truck" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="trailer">Trailer</label>
                                    <input id="trailer" type="number" name="trailer" value="0" min="0">
      </div>
                                <div class="form-group">
        <label for="car">Car</label>
                                    <input id="car" type="number" name="car" value="0" min="0">
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Notes Section -->
                    <section class="form-section" data-section="notes">
                        <div class="section-header">
                            <h2><i class="fas fa-sticky-note"></i> Notes</h2>
                            <div class="section-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="section-content collapsed">
                            <div class="form-group">
                                <label for="project_notes">Project Notes</label>
                                <textarea id="project_notes" name="project_notes" rows="6" placeholder="Enter any additional notes or special requirements..."></textarea>
                            </div>
                        </div>
                    </section>

                    <div class="form-actions">
                        <button id="calculate_button" type="button" class="btn btn-primary btn-large">
                            <i class="fas fa-calculator"></i> Calculate Quote
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Panel -->
            <div id="results-panel" class="results-panel hidden">
                <div class="results-header">
                    <h2><i class="fas fa-chart-line"></i> Quote Results</h2>
                    <div class="results-actions">
                        <button id="save-quote-from-results" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Quote
                        </button>
                        <button id="close-results" class="btn btn-icon">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div id="result" class="results-content">
                    <!-- Results will be populated here -->
                </div>
      </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Calculating...</p>
      </div>
    </div>

    <!-- File Input for Loading Quotes -->
    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- Add Customer Modal -->
    <div id="customer-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="customer-modal-title">Create New Customer</h3>
                <button id="close-customer-modal" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="customer-form">
                    <input type="hidden" id="customer_id" name="customer_id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer_firstname">First Name</label>
                            <input id="customer_firstname" type="text" name="customer_firstname" required>
                        </div>
                        <div class="form-group">
                            <label for="customer_lastname">Last Name</label>
                            <input id="customer_lastname" type="text" name="customer_lastname" required>
                        </div>
                        <div class="form-group">
                            <label for="customer_email">Email</label>
                            <input id="customer_email" type="email" name="customer_email">
                        </div>
                        <div class="form-group">
                            <label for="customer_mobile">Mobile</label>
                            <input id="customer_mobile" type="tel" name="customer_mobile">
                        </div>
                        <div class="form-group full-width">
                            <label for="customer_address">Address</label>
                            <input id="customer_address" type="text" name="customer_address">
                        </div>
                        <div class="form-group">
                            <label for="customer_apartment">Apartment, Suite, etc.</label>
                            <input id="customer_apartment" type="text" name="customer_apartment">
                        </div>
                        <div class="form-group">
                            <label for="customer_city">Town/Suburb</label>
                            <input id="customer_city" type="text" name="customer_city">
                        </div>
                        <div class="form-group">
                            <label for="customer_postcode">Postcode</label>
                            <input id="customer_postcode" type="text" name="customer_postcode">
                        </div>
                        <div class="form-group">
                            <label for="customer_state">State</label>
                            <input id="customer_state" type="text" name="customer_state" value="Queensland">
                        </div>
                        <div class="form-group">
                            <label for="customer_country">Country</label>
                            <input id="customer_country" type="text" name="customer_country" value="Australia">
                        </div>
                        <div class="form-group">
                            <label for="customer_company">Company Name</label>
                            <input id="customer_company" type="text" name="customer_company">
                        </div>
                        <div class="form-group">
                            <label for="customer_abn">ABN</label>
                            <input id="customer_abn" type="text" name="customer_abn">
                        </div>
                        <div class="form-group">
                            <label for="customer_phone">Company Phone</label>
                            <input id="customer_phone" type="tel" name="customer_phone">
                        </div>
                         <div class="form-group">
                            <label for="customer_fax">Fax</label>
                            <input id="customer_fax" type="text" name="customer_fax">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="save-customer-btn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Customer
                </button>
            </div>
        </div>
    </div>

    <!-- Area Calculator Modal (shared for both forms) -->
    <div id="area-calc-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width:420px;">
            <div class="modal-header">
                <h3>Area Calculator</h3>
                <button id="close-area-calc-modal" class="btn btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="area-calc-form">
                    <div class="form-group">
                        <label for="area-calc-label">Label (optional)</label>
                        <input id="area-calc-label" type="text" placeholder="e.g., Pothole 1">
                    </div>
                    <div class="form-group">
                        <label for="area-calc-length">Length (mm)</label>
                        <input id="area-calc-length" type="number" min="0" step="1" required placeholder="e.g., 1200">
                    </div>
                    <div class="form-group">
                        <label for="area-calc-width">Width (mm)</label>
                        <input id="area-calc-width" type="number" min="0" step="1" required placeholder="e.g., 3000">
                    </div>
                    <button type="button" id="area-calc-add-btn" class="btn btn-success"><i class="fas fa-plus"></i> Add</button>
                </form>
                <div id="area-calc-list" class="area-calc-list mt-3"></div>
                <div class="mt-2"><strong>Total Area:</strong> <span id="area-calc-total">0.00</span> m²</div>
            </div>
            <div class="modal-footer">
                <button type="button" id="area-calc-save-btn" class="btn btn-primary">Save</button>
                <button type="button" id="area-calc-cancel-btn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="scripts.js" type="text/javascript"></script>
</body>
</html>
